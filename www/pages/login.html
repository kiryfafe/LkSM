<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Вход в личный кабинет</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/registr.css">
</head>
<body>
  <div class="register-container">
    <h2>Вход</h2>
    <input id="login-identifier" type="text" placeholder="Email или телефон" required>
    <input id="login-password" type="password" placeholder="Пароль" required>
    <button id="login-btn" class="btn-Save">Войти</button>
    <p id="login-success" class="msg-success" style="display:none;">Успешный вход!</p>
    <p id="login-error" class="msg-error" style="display:none;">Ошибка входа!</p>
    <p class="login-link">
      Нет аккаунта? <a href="register.html">Зарегистрироваться</a>
    </p>
  </div>
  <script src="../js/api.js"></script>
  <script src="../js/auth.js"></script>
  <script>
    const btn = document.getElementById("login-btn");
    const msgSuccess = document.getElementById("login-success");
    const msgError = document.getElementById("login-error");

    async function performLogin() {
      const identifier = document.getElementById("login-identifier").value.trim();
      const password = document.getElementById("login-password").value.trim();

      if (!identifier || !password) {
        msgError.textContent = "Заполните все поля";
        msgError.style.display = "block";
        msgSuccess.style.display = "none";
        return;
      }

      // Скрываем предыдущие сообщения
      msgSuccess.style.display = "none";
      msgError.style.display = "none";

      try {
        const ok = await Auth.login(identifier, password);
        if (ok) {
          msgSuccess.textContent = "Успешный вход!";
          msgSuccess.style.display = "block";
          msgError.style.display = "none";
          setTimeout(() => window.location.href = "../index.html", 1000);
        } else {
          msgError.textContent = "Неверный email/телефон или пароль";
          msgError.style.display = "block";
          msgSuccess.style.display = "none";
        }
      } catch (e) {
        console.error("Login error:", e);
        msgError.textContent = "Ошибка входа: " + (e.message || "Неизвестная ошибка");
        msgError.style.display = "block";
        msgSuccess.style.display = "none";
      }
    }

    btn.addEventListener("click", performLogin);
    
    // Обработка Enter
    document.getElementById("login-password").addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        performLogin();
      }
    });
  </script>
</body>
</html>